# BTC/USDT 終値 HIGH/LOW 予測モデル構築サマリー (途中経過)

このドキュメントは、BTC/USDT の5分足データ (`BTCUSDT_5m_data_max.csv`) を使用して、次の足の終値が現在の足より高いか低いかを予測する二値分類モデル構築の途中経過をまとめたものです。

## 1. データ準備フェーズ

*   **データ読み込みと前処理:**
    *   `BTCUSDT_5m_data_max.csv` を Pandas DataFrame として読み込みました。
    *   `timestamp` 列を日時形式に変換し、インデックスに設定しました。
    *   `turnover` 列を削除しました。
    *   欠損値は存在しませんでした。
    *   データ型を確認し、数値型であることを確認しました。
*   **目的変数作成:**
    *   次の足の終値が現在の足より高い場合に 1 (HIGH)、低い場合に 0 (LOW) となる `target` 列を作成しました。
    *   目的変数の分布は、クラス0 (LOW) が約 50.6%、クラス1 (HIGH) が約 49.4% でした。
*   **特徴量エンジニアリング:**
    *   基本的な特徴量 (`open`, `high`, `low`, `close`, `volume`) に加えて、以下の特徴量を追加しました。
        *   移動平均線 (SMA: 5, 10, 20, 50期間)
        *   ラグ特徴量 (過去の終値: 1, 2, 3, 5期間前)
        *   テクニカル指標 (EMA: 5, 10, 20期間, RSI: 14期間, MACD, ボリンジャーバンド: %B, Bandwidth, 価格変動率: ROC 1期間, ボラティリティ: 標準偏差 14期間)
        *   出来高ラグ特徴量 (過去の出来高: 1, 2, 3, 5期間前)
        *   ローソク足の数値的特徴量 (True Range, Body Size, Upper Shadow, Lower Shadow)
        *   追加の出来高関連特徴量 (出来高の移動平均: 5, 10, 20期間, 出来高の変動率)
        *   価格と指標の組み合わせ特徴量 (価格とSMAの比率: 5, 10, 20期間, RSIの差分, MACD Histogram)
        *   日中パターン・季節性特徴量 (Hour, Day of Week)
        *   出来高加重移動平均 (VWAP)
    *   特徴量追加により発生したNaNを含む58行、および無限大の値を含む78行を削除しました。
*   **データ分割:**
    *   データを時系列順に訓練データ (70%)、検証データ (15%)、テストデータ (15%) に分割しました。

## 2. モデル構築・評価フェーズ (更新)

データ準備後、以下のモデルで学習と評価を行いました。評価は検証データとテストデータで行い、目標精度はテストデータでの Accuracy 55%以上としました。

### 初期モデル評価 (特徴量強化後)

強化された特徴量セットを使用し、初期モデル（ロジスティック回帰、ランダムフォレスト、LightGBM、XGBoost）の評価を行いました。

*   **ロジスティック回帰:**
    *   **テスト精度 (Accuracy):** 0.5095
*   **ランダムフォレスト:**
    *   **テスト精度 (Accuracy):** 0.5055
*   **LightGBM:**
    *   **テスト精度 (Accuracy):** 0.5134
*   **XGBoost:**
    *   **テスト精度 (Accuracy):** 0.5044

いずれのモデルも目標精度に達しませんでした。

### LightGBM ハイパーパラメータ調整

LightGBM モデルに対して、TimeSeriesSplit を用いた RandomizedSearchCV によるハイパーパラメータ調整を実施しました。

*   **最適なハイパーパラメータ:** {'subsample': 0.9, 'reg_lambda': 0, 'reg_alpha': 1.0, 'num_leaves': 31, 'n_estimators': 100, 'min_child_samples': 100, 'max_depth': 10, 'learning_rate': 0.01, 'colsample_bytree': 0.7} (探索結果の一例)
*   **ベストクロスバリデーションスコア (Accuracy):** 0.5325 (訓練+検証データでの評価)
*   **テスト精度 (Accuracy):** 0.5134 (調整後モデル)

ハイパーパラメータ調整を行っても、テスト精度は目標の55%に達しませんでした。

### ベースラインモデル比較

訓練したモデルの性能を評価するため、以下の単純なベースラインモデルと比較しました。

*   **Baseline: Always HIGH** (常に終値が上がると予測)
    *   **テスト精度 (Accuracy):** 0.4989
*   **Baseline: Previous Direction** (前の足と同じ方向に動くと予測)
    *   **テスト精度 (Accuracy):** 0.4849

訓練したモデルは、いずれもこれらのベースラインモデルの精度をわずかに上回っています。

## 結論 (現時点)

強化された特徴量セットと初期モデル、およびLightGBMのハイパーパラメータ調整では、目標とする 55% の予測精度を達成できませんでした。モデルはベースライン予測よりはわずかに優れているものの、実用的な予測精度には至っていません。

今後のステップとして、さらなる特徴量エンジニアリングの検討、より複雑なモデル（ニューラルネットワークなど）の導入、あるいは複数のモデルを組み合わせるアンサンブル手法などが必要と考えられます。