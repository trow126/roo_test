# BTC/USDT 終値 HIGH/LOW 予測モデル構築サマリー (途中経過)

このドキュメントは、BTC/USDT の5分足データ (`BTCUSDT_5m_data_max.csv`) を使用して、次の足の終値が現在の足より高いか低いかを予測する二値分類モデル構築の途中経過をまとめたものです。

## 1. データ準備フェーズ

*   **データ読み込みと前処理:**
    *   `BTCUSDT_5m_data_max.csv` を Pandas DataFrame として読み込みました。
    *   `timestamp` 列を日時形式に変換し、インデックスに設定しました。
    *   `turnover` 列を削除しました。
    *   欠損値は存在しませんでした。
    *   データ型を確認し、数値型であることを確認しました。
*   **目的変数作成:**
    *   次の足の終値が現在の足より高い場合に 1 (HIGH)、低い場合に 0 (LOW) となる `target` 列を作成しました。
    *   目的変数の分布は、クラス0 (LOW) が約 50.6%、クラス1 (HIGH) が約 49.4% でした。
*   **特徴量エンジニアリング:**
    *   基本的な特徴量 (`open`, `high`, `low`, `close`, `volume`) を使用しました。
    *   移動平均線 (SMA: 5, 10, 20, 50期間) を特徴量として追加しました。
    *   ラグ特徴量 (過去の終値: 1, 2, 3, 5期間前) を特徴量として追加しました。
    *   特徴量追加により発生したNaNを含む49行を削除しました。
*   **データ分割:**
    *   データを時系列順に訓練データ (70%)、検証データ (15%)、テストデータ (15%) に分割しました。

## 2. モデル構築・評価フェーズ (初期モデル)

データ準備後、以下の3つのモデルで学習と評価を行いました。評価は検証データとテストデータで行い、目標精度はテストデータでの Accuracy 55%以上としました。

### ロジスティック回帰

*   **検証精度 (Accuracy):** 0.5163
*   **テスト精度 (Accuracy):** 0.5122
*   **評価:** 目標精度に達しませんでした。クラス0 (LOW) の Recall が高く、クラス1 (HIGH) の Recall が低い傾向が見られました。

### ランダムフォレスト

*   **検証精度 (Accuracy):** 0.5026
*   **テスト精度 (Accuracy):** 0.5030
*   **評価:** 目標精度に達しませんでした。ロジスティック回帰よりもさらにクラス0 (LOW) への予測に偏りが見られました。

### LightGBM

*   **検証精度 (Accuracy):** 0.4960
*   **テスト精度 (Accuracy):** 0.5011
*   **評価:** 目標精度に達しませんでした。検証データとテストデータで極端にクラス0 (LOW) を予測する傾向が見られました。早期停止が早く働き、学習が十分に進行しなかった可能性があります。

## 結論 (中間)

初期のモデルと基本的な特徴量では、目標とする 55% の予測精度を達成できませんでした。特に、モデルが価格上昇（HIGH）を捉えるのが難しい傾向が見られます。

今後のステップとして、特徴量エンジニアリングの強化（他のテクニカル指標の追加など）、モデルのハイパーパラメータ調整、あるいは他のモデル（XGBoostなど）の検討が必要です。

ただし、ユーザーからの新しい要件として「マイクロサービス化して疎結合にする」「頻繁にリファクタしてきれいなコードを保つ」が提示されました。これらの要件はコードのアーキテクチャと構造に大きく関わるため、今後の作業の進め方について再検討が必要です。